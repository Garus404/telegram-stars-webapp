<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Оплата Stars в Telegram</title>
</head>
<body>
  <button id="payBtn">Оплатить Stars</button>

  <script>
    // Проверяем, что Web App запускается из Telegram
    if (!window.Telegram.WebApp) {
      console.error("Этот скрипт должен запускаться внутри Telegram Web App!");
    } else {
      const tg = window.Telegram.WebApp;

      console.log("Telegram WebApp инициализирован");

      const payBtn = document.getElementById('payBtn');

      payBtn.addEventListener('click', () => {
        console.log("Нажата кнопка оплаты, запускаем процесс...");

        // Здесь имитируем вызов оплаты Stars
        // В реальном Telegram API используется Telegram.WebApp.showPayment или подобный метод
        // Но в Stars Web Apps нужно запустить платёж через Telegram API с использованием invoice и т.п.

        // Для примера — вызов Telegram.WebApp.openInvoice() не существует,
        // обычно это делается через бота и invoice, а тут мы эмулируем оплату

        // Покажем простое окно с подтверждением оплаты
        const transactionId = "stars_txn_" + Date.now();

        console.log("Симуляция успешной оплаты, transaction id:", transactionId);

        // Возвращаем данные об оплате через _return
        // Аргументы: (id транзакции, true = успех, null = без ошибки)
        _return(transactionId, true, null);

        // Дополнительно можно закрыть WebApp, если нужно
        // tg.close(); 
      });

      // Заготовка функции _return — Telegram WebApp ожидает её
      function _return(data_id, success, error) {
        console.log("Вызвана _return:");
        console.log("  data_id:", data_id);
        console.log("  success:", success);
        console.log("  error:", error);

        // В реальном WebApp обычно используется Telegram.WebApp.sendData или postMessage
        // Здесь просто вывод в консоль, замени под свои нужды

        // Если WebApp поддерживает sendData:
        if (tg.sendData) {
          const result = {
            transaction_id: data_id,
            success: success,
            error: error,
          };
          tg.sendData(JSON.stringify(result));
          console.log("Данные отправлены в Telegram через sendData");
        }
      }
    }
  </script>
</body>
</html>
